<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Examples</title>
<script src="d3.v3.min.js"></script>
<script src="topology.js"></script>
<link rel="stylesheet" type="text/css" href="topology.css">
</head>

<body>
  <div id="container">
    <svg id="topology_svg">
      <def> 
        <marker orient="auto" markerHeight="30" markerWidth="30" refY="15" refX="-25" id="markerStart"  markerUnits="userSpaceOnUse"><circle cy="15" cx="15" r="12"></circle></marker>
        <marker orient="auto" markerHeight="30" markerWidth="30" refY="15" refX="55" id="markerEnd" markerUnits="userSpaceOnUse"><circle cy="15" cx="15" r="12"></circle></marker>
      </def>
    </svg>
  </div>
  <div id="nodeInfo" class="tooltip">
    <a class="closeBtn" href="#">&times;</a>
    <div class="head"></div>
    <ul>
      <li>Description : <span class="desc"></span></li>
      <li>Manage IP : <span class="mip"></span></li>
      <li>Port Num : <span class="port_num"></span></li>
    </ul>
  </div>
  <div id="linkInfo" class="tooltip">
    <a class="closeBtn" href="#">&times;</a>
    <div class="head"></div>
    <ul>
      <li>Bandwidth : <span class="bandwidth"></span></li>
    </ul>
  </div>


<script type="text/javascript">

// this "data" could be generated by <?php?> variable or ajax
var data = {
  nodes: [
    {id:'WHG',mip:'10.4.41.1',type:'gateway',port_num:'12',desc:''},
    {id:'A',mip:'10.4.42.1',type:'switch',port_num:'12',desc:'HOHOHO'},
    {id:'B',mip:'10.4.43.1',type:'switch',port_num:'12',desc:'HOHOHO'},
    {id:'C',mip:'10.4.44.1',type:'switch',port_num:'12',desc:'HOHOHO'},
    {id:'D',mip:'10.4.45.1',type:'switch',port_num:'15',desc:'HOHOHO'},
    {id:'EAP',mip:'10.4.46.1',type:'apnode',port_num:'12',desc:''},
    {id:'F',mip:'10.4.47.1',type:'switch',port_num:'12',desc:''}
  ],
  links: [
    {source:'WHG',target:'A',src_port:'4',dst_port:'12',bandwidth:'1000'},
    {source:'WHG',target:'B',src_port:'1',dst_port:'12',bandwidth:'1000'},
    {source:'WHG',target:'C',src_port:'2',dst_port:'12',bandwidth:'1000'},
    {source:'WHG',target:'D',src_port:'3',dst_port:'12',bandwidth:'1000'},
    {source:'C',target:'D',src_port:'1',dst_port:'15',bandwidth:'100'},
    {source:'C',target:'EAP',src_port:'2',dst_port:'10',bandwidth:'10'}
  ]
};


var topology=new Topology('topology_svg');

var nodeInfo = d3.select("#nodeInfo");
var linkInfo = d3.select("#linkInfo");

topology.mouseoverLinkHandler = function(d) {
  linkInfo
    .style("display", "block")
    .style("left", ((d.source.x + d.target.x)/2 + 40) + "px")
    .style("top", (d.source.y + d.target.y)/2 + "px")
    .transition()
      .duration(500)
      .style("opacity", .9);

  linkInfo.select(".head").text(
    d.source.id + "(" + d.src_port + ")" + "  ----  " +
    d.target.id + "(" + d.dst_port + ")");
  linkInfo.select(".bandwidth").text(d.bandwidth);
};
topology.mouseoutLinkHandler = function(d) {
  linkInfo
    .style("opacity", 0)
    .style("display", "none");
};

topology.mouseoverNodeHandler = function(d) {
  if (nodeInfo.classed("locked")) return;
  nodeInfo
    .style("display", "block")
    .style("left", (d.x + 70) + "px")
    .style("top", (d.y - 10) + "px")
    .transition()
      .duration(500)
      .style("opacity", .9);

  nodeInfo.select(".head").text(d.id);
  nodeInfo.select(".desc").text(d.desc);
  nodeInfo.select(".mip").text(d.mip);
  nodeInfo.select(".port_num").text(d.port_num);
};
topology.mouseoutNodeHandler = function(d) {
  if (nodeInfo.classed("locked")) return;
  nodeInfo
    .style("opacity", 0)
    .style("display", "none");
};

topology.dblclickNodeHandler = function(d) {
  d.fixed = (!d.fixed);
  nodeInfo.classed("locked", d.fixed);
  d3.select(this).classed("fixed", d.fixed);
  // topology.force.stop();
};

topology.clickAHandler = function(d) {
  // TODO: redirect to node page by id
  alert(d.id);
};

d3.selectAll(".closeBtn").on('click',function(){
  d3.select(this.parentNode)
    .classed('locked',false)
    .style("opacity", 0)
    .style("display", "none");
});

topology.init(data);


</script>
</body>
</html>